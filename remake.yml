# This file is automatically generated from traits.build 
# package, via the file remake.yml.whisker: 
# edit the file there (or the files that it includes).

packages:
  - traits.build

targets:
  all:
    depends:
      - austraits
      - export/data/curr/austraits.rds

  export/data/curr/austraits.rds:
    command: saveRDS(austraits, target_name)

  version_number: 
    command: util_get_version("config/metadata.yml")
    
  git_SHA:
    command: util_get_SHA()
    depends:
      - .git/index  

  schema:
    command: get_schema()

  resource_metadata:
    command: get_schema("config/metadata.yml",  I("metadata"))

  definitions:
    command: get_schema("config/traits.yml", I("traits"))

  unit_conversions:
    command: get_unit_conversions("config/unit_conversions.csv")

  taxon_list:
    command: read_csv_char("config/taxon_list.csv")

  test_dataset_1_config:
    command: >
      dataset_configure("data/test_dataset_1/metadata.yml",
                 definitions,
                 unit_conversions
                 )
  test_dataset_1_raw:
    command: >
      dataset_process("data/test_dataset_1/data.csv",
                  test_dataset_1_config,
                  schema,
                  resource_metadata
                 )
  test_dataset_1:
    command: >
      build_update_taxonomy(test_dataset_1_raw,
                  taxon_list
                 )

  test_dataset_2_config:
    command: >
      dataset_configure("data/test_dataset_2/metadata.yml",
                 definitions,
                 unit_conversions
                 )
  test_dataset_2_raw:
    command: >
      dataset_process("data/test_dataset_2/data.csv",
                  test_dataset_2_config,
                  schema,
                  resource_metadata
                 )
  test_dataset_2:
    command: >
      build_update_taxonomy(test_dataset_2_raw,
                  taxon_list
                 )


  austraits_raw:
    command: >
      build_combine(
        test_dataset_1,
        test_dataset_2,
        NULL)
    
  austraits:
    command: build_add_version(austraits_raw, version_number, git_SHA)
